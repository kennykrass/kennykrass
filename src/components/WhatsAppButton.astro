---
interface Props {
  phone?: string; // Número en formato E.164 sin '+' (e.g., 521234567890)
  text?: string;  // Texto prellenado del mensaje
  class?: string; // Clases extra para estilos
}

const {
  phone: phoneProp,
  text: textProp,
  class: className = '',
} = Astro.props as Props;

// Permitir configurar por variables públicas de Astro (expuestas al cliente)
// Define en tu entorno: PUBLIC_WHATSAPP_NUMBER y PUBLIC_WHATSAPP_TEXT
const envPhone = import.meta.env.PUBLIC_WHATSAPP_NUMBER as string | undefined;
const envText = import.meta.env.PUBLIC_WHATSAPP_TEXT as string | undefined;

const rawPhone = (phoneProp || envPhone || '').toString();
// Sanitiza: conserva solo dígitos
const sanitizedPhone = rawPhone.replace(/\D/g, '');

const message = textProp || envText || 'Hola Kenny, vi tu portafolio y me gustaría hablar sobre un proyecto.';
const encoded = encodeURIComponent(message);

// Si no hay número, no renderizamos el botón
if (!sanitizedPhone) {
  return null;
}

const href = `https://wa.me/${sanitizedPhone}?text=${encoded}`;
---

<a
  href={href}
  target="_blank"
  rel="noopener noreferrer"
  aria-label="Abrir chat de WhatsApp"
  class={`fixed bottom-24 right-8 z-50 inline-flex items-center justify-center rounded-full border transition-all duration-300 
          bg-primary border-gray-700 hover:border-accent hover:shadow-lg 
          h-12 w-12 text-green-400 ${className}`}
>
  <!-- Ícono de WhatsApp -->
  <svg viewBox="0 0 32 32" class="h-6 w-6" fill="currentColor" aria-hidden="true">
    <path d="M19.11 17.08c-.28-.14-1.62-.8-1.87-.89-.25-.09-.43-.14-.62.14-.18.28-.71.88-.87 1.06-.16.18-.32.2-.6.07-.28-.14-1.18-.44-2.25-1.41-.83-.74-1.39-1.66-1.55-1.94-.16-.28-.02-.43.12-.57.12-.12.28-.32.42-.48.14-.16.18-.28.28-.46.09-.18.05-.34-.02-.48-.07-.14-.62-1.5-.85-2.05-.22-.54-.45-.47-.62-.48-.16-.01-.34-.01-.52-.01-.18 0-.48.07-.73.34-.25.28-.96.94-.96 2.29s.98 2.66 1.12 2.84c.14.18 1.93 2.95 4.67 4.13.65.28 1.16.45 1.56.58.65.21 1.25.18 1.72.11.53-.08 1.62-.66 1.85-1.3.23-.64.23-1.19.16-1.3-.07-.11-.25-.18-.53-.32z"/>
    <path d="M27.24 4.76C24.35 1.86 20.33.38 16.2.38 8.01.38 1.37 7.02 1.37 15.2c0 2.51.66 4.96 1.91 7.13L.43 31.62l9.5-2.78c2.11 1.15 4.49 1.75 6.9 1.75h0c8.19 0 14.83-6.64 14.83-14.82 0-3.95-1.54-7.66-4.42-10.56zM16.83 28.6h0c-2.2 0-4.35-.59-6.22-1.69l-.45-.27-5.64 1.65 1.7-5.49-.29-.45c-1.18-1.94-1.81-4.17-1.81-6.46 0-6.92 5.63-12.55 12.55-12.55 3.35 0 6.5 1.31 8.87 3.68 2.37 2.37 3.68 5.52 3.68 8.87-.01 6.91-5.64 12.55-12.57 12.55z"/>
  </svg>
</a>

<style>
  /* Evitar que el botón quede tapado en pantallas pequeñas */
  @media (max-width: 640px) {
    a[aria-label='Abrir chat de WhatsApp'] { bottom: 5.5rem; }
  }
</style>

